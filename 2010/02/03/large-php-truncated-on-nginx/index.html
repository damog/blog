<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Large PHP scripts truncated on nginx | dm&#39;s blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="I spent a couple of hours yesterday trying to debug an issue that made me hit my head against the wall while it lasted.
I run multiple instances of WordPress, and with it, comes a nice little editor b">
<meta property="og:type" content="article">
<meta property="og:title" content="Large PHP scripts truncated on nginx">
<meta property="og:url" content="http://damog.net/blog/2010/02/03/large-php-truncated-on-nginx/index.html">
<meta property="og:site_name" content="dm's blog">
<meta property="og:description" content="I spent a couple of hours yesterday trying to debug an issue that made me hit my head against the wall while it lasted.
I run multiple instances of WordPress, and with it, comes a nice little editor b">
<meta property="og:image" content="http://damog.net/old/stereonaut/2010/02/nginx.gif">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Large PHP scripts truncated on nginx">
<meta name="twitter:description" content="I spent a couple of hours yesterday trying to debug an issue that made me hit my head against the wall while it lasted.
I run multiple instances of WordPress, and with it, comes a nice little editor b">
  
    <link rel="alternative" href="/blog/atom.xml" title="dm&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/blog/favicon.png">
  
  <link rel="stylesheet" href="/blog/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/blog/">dm&#39;s blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/blog/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/blog/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://damog.net/blog"></form>
	</div>
</header>
    <div id="main">
      <article id="post-large-php-truncated-on-nginx" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/blog/2010/02/03/large-php-truncated-on-nginx/" class="article-date">
  <time datetime="2010-02-03T10:35:14.000Z" itemprop="datePublished">Wed Feb 3, 2010</time>
</a>
		</span>
		<span class="meta-elements author">David Moreno</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      Large PHP scripts truncated on nginx
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>I spent a couple of <em>hours</em> yesterday trying to debug an issue that made me hit my head against the wall while it lasted.</p>
<p>I run multiple instances of <a href="http://wordpress.org" target="_blank" rel="external">WordPress</a>, and with it, comes a nice little editor bundled called <a href="http://tinymce.moxiecode.com/" target="_blank" rel="external">TinyMCE</a>. But on my main WordPress installation (<a href="http://stereonaut.net" target="_blank" rel="external">this</a> very blog, dear reader, where you are reading this from), TinyMCE wouldn’t come up, it wouldn’t render properly on the browser, it didn’t matter if it was my main browser, Chrome, or Firefox, Safari, cached, uncached, it was just broken. Since I hadn’t have the time to go through this issue before, I was using a different editor installed as a plugin. <em>LAME</em>. And coward.</p>
<p><img class="alignright size-full wp-image-1113" title="nginx" src="http://damog.net/old/stereonaut/2010/02/nginx.gif" alt="" width="121" height="32">Anyway, I found out that one of the scripts <a href="http://phpxref.ftwr.co.uk/wordpress/nav.html?wp-includes/js/tinymce/wp-tinymce.php.html" target="_blank" rel="external"><tt>wp-tinymce.php</tt></a> was being returned truncated. Because of that, <a href="http://getfirebug.com/" target="_blank" rel="external">Firebug</a> would report that some TinyMCE bullshit wasn’t defined (JavaScript, oh I’m not very fond of you). Oh, well. I tested calling that script under <a href="http://curl.haxx.se/" target="_blank" rel="external">curl</a> separately and in fact, it was only returning a fraction of the script, 44K out of the actual 200+K. I also found out that even though my <a href="http://nginx.org/" target="_blank" rel="external">nginx</a> installation had gzip compression enabled and the PHP had zlib as well, the script wouldn’t process the <tt>tinymce.js.gz</tt> but it was returning directly <tt>tinymce.js</tt>. It’s alright, I just wanted it to work, no matter if it wouldn’t go through gzip, that’d be a matter of some other day.</p>
<p>After a lot of googling I ended up reading <a href="http://www.republicavirtual.com.br/blog/2009/11/03/nginx-truncate-php/" target="_blank" rel="external">this blog post</a> (in Portuguese), suggesting to make sure the file permissions for both the <tt>client_body_temp</tt> and <tt>fastcgi_temp</tt> directories allowed the user running nginx (<tt>www-data</tt> in my case) to write in them. Apparently large scripts would start writing to disk on them temporarily while processing the shit. Of course, you wouldn’t have this issue if you are running an nginx from your operating system package manager (like <a href="http://packages.debian.org/search?keywords=nginx" target="_blank" rel="external">Debian</a>‘s), but this might very well happen when you are running a custom nginx with separate modules and all sorts of crap on top of it:</p>
<p><code lang="bash">chown www-data:www-data -R /usr/local/nginx/fastcgi_temp/;<br>chmod -R 777 /usr/local/nginx/fastcgi_temp/;<br>chown www-data:www-data -R /usr/local/nginx/client_body_temp/;<br>chmod -R 777 /usr/local/nginx/client_body_temp/;</code></p>
<p>Obrigado, <a href="http://www.republicavirtual.com.br/blog/" target="_blank" rel="external">republicavirtual.com.br</a> :-)</p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/gzip/">gzip</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/tinymce/">tinymce</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/wordpress/">wordpress</a></li></ul>

			</span>
		</div>
	</footer>
	
    
<nav id="article-nav">
  
    <a href="/blog/2010/02/04/feed-moved/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Feed moved
        
      </div>
    </a>
  
  
    <a href="/blog/2010/02/02/eben-moglen-freedom-in-the-cloud-nyu/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          Eben Moglen - &#39;Freedom in the Cloud&#39; 2/5 @ NYU
        
      </div>
    </a>
  
</nav>

  
</article>




    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:damog.net/blog">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/blog/">dm&#39;s blog</a>
	</h1>
	<span class="copyright">
		&copy; 2016 David Moreno<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>