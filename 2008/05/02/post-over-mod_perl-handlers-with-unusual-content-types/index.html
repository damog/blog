<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>POST over mod_perl handlers with unusual content types | dm&#39;s blog</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Recently I had to deal with POST requests on mod_perl 2 on a custom XML-RPC webservice server we have been developing and maintaining over the last year (we are actually moving it to REST some time in">
<meta property="og:type" content="article">
<meta property="og:title" content="POST over mod_perl handlers with unusual content types">
<meta property="og:url" content="http://damog.net/blog/2008/05/02/post-over-mod_perl-handlers-with-unusual-content-types/index.html">
<meta property="og:site_name" content="dm's blog">
<meta property="og:description" content="Recently I had to deal with POST requests on mod_perl 2 on a custom XML-RPC webservice server we have been developing and maintaining over the last year (we are actually moving it to REST some time in">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="POST over mod_perl handlers with unusual content types">
<meta name="twitter:description" content="Recently I had to deal with POST requests on mod_perl 2 on a custom XML-RPC webservice server we have been developing and maintaining over the last year (we are actually moving it to REST some time in">
  
    <link rel="alternative" href="/blog/atom.xml" title="dm&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/blog/favicon.png">
  
  <link rel="stylesheet" href="/blog/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/blog/">dm&#39;s blog</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/blog/archives">Archives</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/blog/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://damog.net/blog"></form>
	</div>
</header>
    <div id="main">
      <article id="post-post-over-mod_perl-handlers-with-unusual-content-types" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/blog/2008/05/02/post-over-mod_perl-handlers-with-unusual-content-types/" class="article-date">
  <time datetime="2008-05-02T17:59:00.000Z" itemprop="datePublished">Fri May 2, 2008</time>
</a>
		</span>
		<span class="meta-elements author">David Moreno</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      POST over mod_perl handlers with unusual content types
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<p>Recently I had to deal with POST requests on mod_perl 2 on a custom XML-RPC webservice server we have been developing and maintaining over the last year (we are actually moving it to REST some time in the middle future). It was time to move some of our base modules from a couple of CGIs to the power and muscle of mod_perl.</p>      <p>So, while dealing with POST requests (like XML-RPC is actually specified) I faced the issue that I wasn&#8217;t being able to get the POST data on the PerlResponseHandler phase. I was probably not reading it correctly, I got deeply into it and even read some libapreq source code. All I was getting was some nifty message like &#8220;not supported&#8221;. After reading some documentation (and, to my own shame, the Apache2::Request front page pod) I found out that the usual:</p><br><pre>    use Apache2::Request;<br>    $req = Apache2::Request-&gt;new($r);<br>    @foo = $req-&gt;param(“foo”);<br>    $bar = $req-&gt;args(“bar”);</pre><br><p>will not work on your POST <b>if the content type is different</b> than <i>application/x-www-form-urlencoded</i> or <i>multipart/form-data. </i>For example, say, XML-RPC! So, in case you actually need to read POST data on your mod_perl 2 handler where it&#8217;s not a form or a file upload, you can read the data manually (I didn&#8217;t find a simpler way to read the data, actually):</p><br><pre><b>sub handler {</b><br><b>my</b> $r = <b>shift</b>;<br><br><b>return</b> Apache2::Const::HTTP_BAD_REQUEST <b>unless</b><br>        $r-&gt;method <b>eq</b> “POST” <b>and</b><br>        $r-&gt;headers_in-&gt;<b>{</b>‘Content-Type’<b>}</b> <b>eq</b> ‘text/xml’ <b>and</b><br>        $r-&gt;headers_in-&gt;<b>{</b>‘Content-Length’<b>}</b>;<br><br><b>my</b> $length = $r-&gt;headers_in-&gt;<b>{</b>‘Content-Length’<b>}</b>;<br><br><b>my</b> $xml;<br><br><b>while</b> <b>(</b>$length<b>)</b> <b>{</b><br>        $r-&gt;<b>read</b><b>(</b>$xml, <b>(</b>$length [less than symbol] 2048) ? $length : 2048<b>)</b>;<br>        $length -= <b>length</b><b>(</b>$xml<b>)</b>;<br><b>}</b><br><br>    …</pre><br><p>And you are ready for booze. </p>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
			</span>
			<span class="tags">
				
			</span>
		</div>
	</footer>
	
    
<nav id="article-nav">
  
    <a href="/blog/2008/05/21/once-again/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Once again
        
      </div>
    </a>
  
  
    <a href="/blog/2008/05/02/blog-normalize-on-the-perl-foundation/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          Blog Normalize on The Perl Foundation
        
      </div>
    </a>
  
</nav>

  
</article>




    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:damog.net/blog">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/blog/">dm&#39;s blog</a>
	</h1>
	<span class="copyright">
		&copy; 2016 David Moreno<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>